<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Dashboard</title>
  <style>
    /* Base styles */
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: #f5f5f5;
    }

    .test-dashboard {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .dashboard-header h1 {
      margin: 0;
      color: #333;
      font-size: 24px;
    }

    .dashboard-actions {
      display: flex;
      gap: 10px;
    }

    .dashboard-actions button {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      transition: background-color 0.2s;
    }

    .refresh-btn {
      background-color: #f0f0f0;
      color: #333;
    }

    .refresh-btn:hover {
      background-color: #e0e0e0;
    }

    .run-tests-btn {
      background-color: #4caf50;
      color: white;
    }

    .run-tests-btn:hover {
      background-color: #3d8b40;
    }

    /* Tabs */
    .dashboard-tabs {
      display: flex;
      border-bottom: 1px solid #e0e0e0;
      margin-bottom: 20px;
    }

    .tab-btn {
      padding: 10px 20px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
      color: #666;
      position: relative;
      transition: color 0.2s;
    }

    .tab-btn:hover {
      color: #333;
    }

    .tab-btn.active {
      color: #1976d2;
      font-weight: 500;
    }

    .tab-btn.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: #1976d2;
    }

    /* Summary Tab */
    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .summary-card {
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .summary-card h3 {
      margin-top: 0;
      margin-bottom: 10px;
      font-size: 16px;
      color: #666;
    }

    .card-value {
      font-size: 32px;
      font-weight: 700;
    }

    .summary-card.total {
      background-color: #f5f5f5;
    }

    .summary-card.total .card-value {
      color: #333;
    }

    .summary-card.passed {
      background-color: #e8f5e9;
    }

    .summary-card.passed .card-value {
      color: #2e7d32;
    }

    .summary-card.failed {
      background-color: #ffebee;
    }

    .summary-card.failed .card-value {
      color: #c62828;
    }

    .summary-card.skipped {
      background-color: #fff8e1;
    }

    .summary-card.skipped .card-value {
      color: #f57f17;
    }

    .summary-details {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
      background-color: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
    }

    .summary-item {
      display: flex;
      align-items: center;
    }

    .summary-item .label {
      font-weight: 500;
      margin-right: 8px;
      color: #666;
    }

    .summary-item .value {
      color: #333;
    }

    .test-suites-summary {
      margin-top: 30px;
    }

    .test-suites-summary h3 {
      margin-bottom: 15px;
      font-size: 18px;
      color: #333;
    }

    .suite-summary {
      background-color: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .suite-summary h4 {
      margin-top: 0;
      margin-bottom: 10px;
      color: #333;
    }

    .suite-stats {
      display: flex;
      gap: 20px;
    }

    .stat {
      display: flex;
      align-items: center;
    }

    .stat .label {
      margin-right: 5px;
      color: #666;
    }

    .stat .value {
      font-weight: 500;
    }

    .stat .value.passed {
      color: #2e7d32;
    }

    .stat .value.failed {
      color: #c62828;
    }

    /* Details Tab */
    .filter-controls {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      background-color: #f5f5f5;
      padding: 10px 15px;
      border-radius: 6px;
    }

    .filter-controls span {
      margin-right: 10px;
      color: #666;
    }

    .filter-buttons {
      display: flex;
      gap: 10px;
    }

    .filter-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      background-color: white;
      color: #666;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-btn:hover {
      background-color: #e0e0e0;
    }

    .filter-btn.active {
      background-color: #1976d2;
      color: white;
    }

    .test-suite {
      margin-bottom: 30px;
    }

    .suite-name {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
    }

    .sub-suite {
      background-color: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .sub-suite-name {
      margin-top: 0;
      margin-bottom: 15px;
      color: #333;
    }

    .tests-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 15px;
    }

    .tests-table th {
      text-align: left;
      padding: 10px;
      background-color: #f5f5f5;
      color: #666;
      font-weight: 500;
    }

    .tests-table td {
      padding: 10px;
      border-top: 1px solid #e0e0e0;
    }

    .test-row.passed {
      background-color: #f1f8e9;
    }

    .test-row.failed {
      background-color: #ffebee;
    }

    .test-row.skipped {
      background-color: #fff8e1;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      text-transform: uppercase;
    }

    .status-badge.passed {
      background-color: #c8e6c9;
      color: #2e7d32;
    }

    .status-badge.failed {
      background-color: #ffcdd2;
      color: #c62828;
    }

    .status-badge.skipped {
      background-color: #ffecb3;
      color: #f57f17;
    }

    .error-details {
      background-color: #ffebee;
      border-radius: 4px;
      padding: 10px 15px;
      margin-top: 10px;
    }

    .error-details h5 {
      margin-top: 0;
      margin-bottom: 10px;
      color: #c62828;
    }

    .error-message {
      background-color: #fff;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-family: monospace;
      font-size: 13px;
      margin: 0;
    }

    /* Coverage Tab */
    .coverage-tab {
      padding: 20px 0;
    }

    .coverage-summary {
      background-color: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 30px;
    }

    .coverage-chart {
      height: 30px;
      background-color: #f5f5f5;
      border-radius: 15px;
      position: relative;
      margin-bottom: 15px;
      overflow: hidden;
    }

    .coverage-fill {
      height: 100%;
      background-color: #4caf50;
      border-radius: 15px;
      transition: width 0.5s ease-in-out;
    }

    .coverage-percentage {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #333;
      font-weight: 700;
      text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
    }

    .coverage-description {
      color: #666;
      line-height: 1.5;
    }

    .coverage-files h3 {
      margin-bottom: 15px;
      font-size: 18px;
      color: #333;
    }

    .coverage-table {
      width: 100%;
      border-collapse: collapse;
    }

    .coverage-table th {
      text-align: left;
      padding: 10px;
      background-color: #f5f5f5;
      color: #666;
      font-weight: 500;
    }

    .coverage-table td {
      padding: 10px;
      border-top: 1px solid #e0e0e0;
    }

    .coverage-bar {
      height: 20px;
      background-color: #f5f5f5;
      border-radius: 10px;
      position: relative;
      width: 100%;
      max-width: 150px;
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      background-color: #4caf50;
      border-radius: 10px;
    }

    .coverage-bar span {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #333;
      font-size: 12px;
      font-weight: 500;
      text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
    }

    /* Loading and Error States */
    .loading-container, .error-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 300px;
    }

    .loading-spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 4px solid #1976d2;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-container h3 {
      color: #c62828;
      margin-bottom: 10px;
    }

    .error-container button {
      margin-top: 15px;
      padding: 8px 16px;
      background-color: #1976d2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .error-container button:hover {
      background-color: #1565c0;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .summary-cards {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .suite-stats {
        flex-direction: column;
        gap: 10px;
      }
      
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .dashboard-tabs {
        overflow-x: auto;
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .summary-cards {
        grid-template-columns: 1fr;
      }
      
      .filter-controls {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .filter-buttons {
        margin-top: 10px;
      }
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // Main app component
    class TestDashboard {
      constructor() {
        this.testResults = null;
        this.loading = true;
        this.error = null;
        this.activeTab = 'summary';
        this.filter = 'all';
        
        this.init();
      }
      
      async init() {
        try {
          // Try to fetch the test results JSON file
          const response = await fetch('./test-dashboard-data.json');
          if (!response.ok) {
            throw new Error('Test results not found');
          }
          this.testResults = await response.json();
          this.loading = false;
        } catch (err) {
          console.log('Using mock data:', err.message);
          // Fall back to mock data if the file doesn't exist
          this.testResults = this.generateMockTestResults();
          this.loading = false;
        }
        
        this.render();
        this.addEventListeners();
      }
      
      // Generate mock test results for demonstration
      generateMockTestResults() {
        const apiTests = {
          name: 'API Service Tests',
          passed: 14,
          failed: 1,
          skipped: 0,
          duration: 1.23,
          suites: [
            {
              name: 'analyzeText',
              tests: [
                { name: 'should return a successful response with simulated data', status: 'passed', duration: 0.12 },
                { name: 'should handle empty text input', status: 'passed', duration: 0.05 },
                { name: 'should simulate network delay', status: 'passed', duration: 0.21 }
              ]
            },
            {
              name: 'analyzeFile',
              tests: [
                { name: 'should return a successful response with simulated data for a text file', status: 'passed', duration: 0.15 },
                { name: 'should handle null file input', status: 'passed', duration: 0.04 }
              ]
            },
            {
              name: 'submitFeedback',
              tests: [
                { name: 'should return a successful response for valid feedback', status: 'passed', duration: 0.08 },
                { name: 'should handle missing feedback type', status: 'passed', duration: 0.06 }
              ]
            },
            {
              name: 'trackScan',
              tests: [
                { name: 'should return a successful response for tracking with metadata', status: 'passed', duration: 0.07 },
                { name: 'should return a successful response for tracking without metadata', status: 'passed', duration: 0.05 }
              ]
            },
            {
              name: 'exportReport',
              tests: [
                { name: 'should return a successful response for PDF export', status: 'passed', duration: 0.11 },
                { name: 'should handle missing result data', status: 'passed', duration: 0.06 },
                { name: 'should support different export formats', status: 'failed', duration: 0.09, 
                  error: 'Expected property "format" to equal "csv" but received "pdf"' }
              ]
            }
          ]
        };
        
        const componentTests = {
          name: 'Component Tests',
          passed: 7,
          failed: 0,
          skipped: 0,
          duration: 2.45,
          suites: [
            {
              name: 'ContentDetectPage Component',
              tests: [
                { name: 'renders the component with initial state', status: 'passed', duration: 0.35 },
                { name: 'handles text input and character count', status: 'passed', duration: 0.28 },
                { name: 'disables analyze button when text is too short', status: 'passed', duration: 0.31 },
                { name: 'enables analyze button when text meets minimum length', status: 'passed', duration: 0.42 },
                { name: 'analyzes text and displays results', status: 'passed', duration: 0.52 },
                { name: 'switches between text and file tabs', status: 'passed', duration: 0.27 },
                { name: 'opens and submits feedback', status: 'passed', duration: 0.30 }
              ]
            }
          ]
        };
        
        return {
          summary: {
            total: apiTests.passed + apiTests.failed + apiTests.skipped + 
                  componentTests.passed + componentTests.failed + componentTests.skipped,
            passed: apiTests.passed + componentTests.passed,
            failed: apiTests.failed + componentTests.failed,
            skipped: apiTests.skipped + componentTests.skipped,
            duration: apiTests.duration + componentTests.duration,
            coverage: 87.5, // Mock coverage percentage
            lastRun: new Date().toISOString()
          },
          suites: [apiTests, componentTests]
        };
      }
      
      // Filter tests based on status
      getFilteredTests(suite) {
        if (this.filter === 'all') return suite.tests;
        return suite.tests.filter(test => test.status === this.filter);
      }
      
      // Set active tab
      setActiveTab(tab) {
        this.activeTab = tab;
        this.render();
      }
      
      // Set filter
      setFilter(filter) {
        this.filter = filter;
        this.render();
      }
      
      // Add event listeners
      addEventListeners() {
        // Tab buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const tab = e.target.getAttribute('data-tab');
            this.setActiveTab(tab);
          });
        });
        
        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const filter = e.target.getAttribute('data-filter');
            this.setFilter(filter);
          });
        });
        
        // Refresh button
        const refreshBtn = document.querySelector('.refresh-btn');
        if (refreshBtn) {
          refreshBtn.addEventListener('click', () => {
            window.location.reload();
          });
        }
      }
      
      // Render the dashboard
      render() {
        const app = document.getElementById('app');
        
        // Render loading state
        if (this.loading) {
          app.innerHTML = `
            <div class="test-dashboard">
              <div class="loading-container">
                <div class="loading-spinner"></div>
                <p>Loading test results...</p>
              </div>
            </div>
          `;
          return;
        }
        
        // Render error state
        if (this.error) {
          app.innerHTML = `
            <div class="test-dashboard">
              <div class="error-container">
                <h3>Error</h3>
                <p>${this.error}</p>
                <button onclick="window.location.reload()">Retry</button>
              </div>
            </div>
          `;
          return;
        }
        
        // Render dashboard
        let content = `
          <div class="test-dashboard">
            <div class="dashboard-header">
              <h1>Test Results Dashboard</h1>
              <div class="dashboard-actions">
                <button class="refresh-btn">
                  <i class="fa-solid fa-sync-alt"></i> Refresh
                </button>
              </div>
            </div>
            
            <div class="dashboard-tabs">
              <button 
                class="tab-btn ${this.activeTab === 'summary' ? 'active' : ''}"
                data-tab="summary"
              >
                Summary
              </button>
              <button 
                class="tab-btn ${this.activeTab === 'details' ? 'active' : ''}"
                data-tab="details"
              >
                Test Details
              </button>
              <button 
                class="tab-btn ${this.activeTab === 'coverage' ? 'active' : ''}"
                data-tab="coverage"
              >
                Coverage
              </button>
            </div>
        `;
        
        // Summary tab
        if (this.activeTab === 'summary') {
          content += `
            <div class="summary-tab">
              <div class="summary-cards">
                <div class="summary-card total">
                  <h3>Total Tests</h3>
                  <div class="card-value">${this.testResults.summary.total}</div>
                </div>
                <div class="summary-card passed">
                  <h3>Passed</h3>
                  <div class="card-value">${this.testResults.summary.passed}</div>
                </div>
                <div class="summary-card failed">
                  <h3>Failed</h3>
                  <div class="card-value">${this.testResults.summary.failed}</div>
                </div>
                <div class="summary-card skipped">
                  <h3>Skipped</h3>
                  <div class="card-value">${this.testResults.summary.skipped}</div>
                </div>
              </div>
              
              <div class="summary-details">
                <div class="summary-item">
                  <span class="label">Duration:</span>
                  <span class="value">${this.testResults.summary.duration.toFixed(2)}s</span>
                </div>
                <div class="summary-item">
                  <span class="label">Last Run:</span>
                  <span class="value">${new Date(this.testResults.summary.lastRun).toLocaleString()}</span>
                </div>
                <div class="summary-item">
                  <span class="label">Coverage:</span>
                  <span class="value">${this.testResults.summary.coverage}%</span>
                </div>
              </div>
              
              <div class="test-suites-summary">
                <h3>Test Suites</h3>
                ${this.testResults.suites.map((suite, index) => `
                  <div class="suite-summary">
                    <h4>${suite.name}</h4>
                    <div class="suite-stats">
                      <div class="stat">
                        <span class="label">Passed:</span>
                        <span class="value passed">${suite.passed}</span>
                      </div>
                      <div class="stat">
                        <span class="label">Failed:</span>
                        <span class="value failed">${suite.failed}</span>
                      </div>
                      <div class="stat">
                        <span class="label">Duration:</span>
                        <span class="value">${suite.duration.toFixed(2)}s</span>
                      </div>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
        
        // Details tab
        if (this.activeTab === 'details') {
          content += `
            <div class="details-tab">
              <div class="filter-controls">
                <span>Filter:</span>
                <div class="filter-buttons">
                  <button 
                    class="filter-btn ${this.filter === 'all' ? 'active' : ''}"
                    data-filter="all"
                  >
                    All
                  </button>
                  <button 
                    class="filter-btn ${this.filter === 'passed' ? 'active' : ''}"
                    data-filter="passed"
                  >
                    Passed
                  </button>
                  <button 
                    class="filter-btn ${this.filter === 'failed' ? 'active' : ''}"
                    data-filter="failed"
                  >
                    Failed
                  </button>
                  <button 
                    class="filter-btn ${this.filter === 'skipped' ? 'active' : ''}"
                    data-filter="skipped"
                  >
                    Skipped
                  </button>
                </div>
              </div>
              
              <div class="test-details">
                ${this.testResults.suites.map((suite, suiteIndex) => `
                  <div class="test-suite">
                    <h3 class="suite-name">${suite.name}</h3>
                    
                    ${suite.suites.map((subSuite, subSuiteIndex) => `
                      <div class="sub-suite">
                        <h4 class="sub-suite-name">${subSuite.name}</h4>
                        
                        <table class="tests-table">
                          <thead>
                            <tr>
                              <th>Test</th>
                              <th>Status</th>
                              <th>Duration</th>
                            </tr>
                          </thead>
                          <tbody>
                            ${this.getFilteredTests(subSuite).map((test, testIndex) => `
                              <tr class="test-row ${test.status}">
                                <td class="test-name">${test.name}</td>
                                <td class="test-status">
                                  <span class="status-badge ${test.status}">
                                    ${test.status}
                                  </span>
                                </td>
                                <td class="test-duration">${test.duration.toFixed(2)}s</td>
                              </tr>
                            `).join('')}
                          </tbody>
                        </table>
                        
                        ${subSuite.tests.some(test => test.status === 'failed') ? `
                          <div class="failed-tests">
                            ${subSuite.tests
                              .filter(test => test.status === 'failed')
                              .map((test, index) => `
                                <div class="error-details">
                                  <h5>Error in: ${test.name}</h5>
                                  <pre class="error-message">${test.error}</pre>
                                </div>
                              `).join('')}
                          </div>
                        ` : ''}
                      </div>
                    `).join('')}
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }
        
        // Coverage tab
        if (this.activeTab === 'coverage') {
          content += `
            <div class="coverage-tab">
              <div class="coverage-summary">
                <div class="coverage-chart">
                  <div 
                    class="coverage-fill" 
                    style="width: ${this.testResults.summary.coverage}%"
                  ></div>
                  <span class="coverage-percentage">${this.testResults.summary.coverage}%</span>
                </div>
                <p class="coverage-description">
                  Code coverage represents the percentage of your codebase that is covered by tests.
                  Higher coverage generally indicates better test quality.  
                </p>
              </div>
              
              <div class="coverage-files">
                <h3>Coverage by File</h3>
                <table class="coverage-table">
                  <thead>
                    <tr>
                      <th>File</th>
                      <th>Statements</th>
                      <th>Branches</th>
                      <th>Functions</th>
                      <th>Lines</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>src/services/api.js</td>
                      <td>
                        <div class="coverage-bar">
                          <div class="bar-fill" style="width: 95%"></div>
                          <span>95%</span>
                        </div>
                      </td>
                      <td>
                        <div class="coverage-bar">
                          <div class="bar-fill" style="width: 85%"></div>
                          <span>85%</span>
                        </div>
                      </td>
                      <td>
                        <div class="coverage-bar">
                          <div class="bar-fill" style="width: 100%"></div>
                          <span>100%</span>
                        </div>
                      </td>
                      <td>
                        <div class="coverage-bar">
                          <div class="bar-fill" style="width: 92%"></div>
                          <span>92%</span>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td>src/pages/contentDetectPage.jsx</td>
                      <td>
                        <div class="coverage-bar">
                          <div class="bar-fill" style="width: 82%"></div>
                          <span>82%</span>
                        </div>
                      </td>
                      <td>
                        <div class="coverage-bar">
                          <div class="bar-fill" style="width: 75%"></div>
                          <span>75%</span>
                        </div>
                      </td>
                      <td>
                        <div class="coverage-bar">
                          <div class="bar-fill" style="width: 90%"></div>
                          <span>90%</span>
                        </div>
                      </td>
                      <td>
                        <div class="coverage-bar">
                          <div class="bar-fill" style="width: 85%"></div>
                          <span>85%</span>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          `;
        }
        
        content += `</div>`;
        app.innerHTML = content;
        
        // Re-add event listeners after rendering
        this.addEventListeners();
      }
    }
    
    // Initialize the dashboard
    document.addEventListener('DOMContentLoaded', () => {
      new TestDashboard();
    });
  </script>
</body>
</html>